<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitcoin Core Code Walkthrough</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0f172a;
      --panel: #111827;
      --panel-light: #f8fafc;
      --fg: #e2e8f0;
      --fg-light: #0f172a;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --border: #1e293b;
      --border-light: #e2e8f0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: linear-gradient(135deg, rgba(15,23,42,0.97), rgba(8,47,73,0.93));
      color: var(--fg);
      min-height: 100vh;
    }
    .page {
      max-width: 1180px;
      margin: 0 auto;
      padding: 32px 20px 60px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }
    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.5px;
    }
    p.lede {
      margin: 6px 0 0;
      color: var(--muted);
    }
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    input[type="search"], select {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: inherit;
      min-width: 220px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 14px;
      margin-top: 16px;
    }
    .card {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.25);
      transition: transform 160ms ease, border-color 160ms ease;
    }
    .card:hover {
      transform: translateY(-2px);
      border-color: var(--accent);
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(56,189,248,0.12);
      color: var(--fg);
      border: 1px solid rgba(56,189,248,0.3);
    }
    .muted { color: var(--muted); }
    details {
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
      padding: 10px 12px;
      margin-top: 10px;
    }
    summary {
      cursor: pointer;
      font-weight: 600;
      outline: none;
    }
    code {
      font-family: "SFMono-Regular", Consolas, ui-monospace, monospace;
      background: rgba(255,255,255,0.06);
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid var(--border);
      white-space: nowrap;
    }
    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 28px 0 8px;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.2px;
    }
    .list {
      display: grid;
      gap: 6px;
      margin: 10px 0 0;
      padding: 0;
      list-style: none;
    }
    .list li {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.03);
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .cmd {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: rgba(15,23,42,0.8);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: "SFMono-Regular", Consolas, ui-monospace, monospace;
      font-size: 13px;
      color: var(--fg);
    }
    .tag {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(148,163,184,0.2);
      color: var(--fg);
      border: 1px solid rgba(148,163,184,0.3);
    }
    .flex {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .footnote {
      color: var(--muted);
      margin-top: 18px;
      font-size: 13px;
    }
    @media (max-width: 640px) {
      header { flex-direction: column; align-items: flex-start; }
      .controls { width: 100%; }
      input[type="search"], select { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div>
        <h1>Bitcoin Core Code Walkthrough</h1>
        <p class="lede">Interactive cheatsheet for architecture, hot paths, and files to read.</p>
      </div>
      <div class="controls">
        <input id="search" type="search" placeholder="Search components, files, flows..." />
        <select id="filter">
          <option value="all">All areas</option>
          <option value="consensus">Consensus</option>
          <option value="p2p">P2P</option>
          <option value="mempool">Mempool/Fees</option>
          <option value="wallet">Wallet</option>
          <option value="rpc">RPC</option>
          <option value="test">Testing</option>
        </select>
      </div>
    </header>

    <div class="grid" id="cards"></div>

    <div class="section-title">Quick start commands</div>
    <ul class="list">
      <li><span>Build (no GUI)</span> <code class="cmd">./autogen.sh && ./configure --without-gui && make -j$(nproc)</code></li>
      <li><span>Run on signet</span> <code class="cmd">src/bitcoind -signet -datadir=/tmp/btc-signet</code></li>
      <li><span>CLI call</span> <code class="cmd">src/bitcoin-cli -signet getblockchaininfo</code></li>
      <li><span>Functional test</span> <code class="cmd">test/functional/test_runner.py feature_fee_estimation.py</code></li>
    </ul>

    <div class="section-title">Docs worth skimming</div>
    <ul class="list" id="docs"></ul>

    <p class="footnote">Tip: read code with the docs side by side. Validation and net_processing are long; search for entry points listed above, then follow call graphs.</p>
  </div>

  <script>
    const data = [
      {
        title: "Consensus + Validation",
        area: "consensus",
        files: [
          "src/validation.cpp (AcceptBlock, ActivateBestChain, mempool entry)",
          "src/consensus/tx_verify.cpp (CheckTxInputs, fees in consensus rules)",
          "src/script/interpreter.cpp (script execution, flags)",
          "src/primitives/block.cpp (Block serialization, merkle)"
        ],
        flow: "Blocks are checked (syntax, merkle, PoW), contextual checks (height, timestamps), then UTXO updates via CCoinsViewCache. Script verification runs under consensus flags.",
        extras: [
          "doc/validation.md",
          "doc/reorgs.md"
        ]
      },
      {
        title: "Mempool + Policy",
        area: "mempool",
        files: [
          "src/validation.cpp (AcceptToMemoryPool, package limits)",
          "src/policy/policy.cpp (IsStandardTx, standard script rules)",
          "src/policy/fees.cpp (fee estimation, buckets)",
          "src/txmempool.cpp (ancestor/descendant tracking)"
        ],
        flow: "Transactions hit policy checks (standardness, size, fee rate, limits), enter mempool with ancestor/descendant accounting, and influence fee estimates via historical buckets.",
        extras: [
          "doc/mempool-and-fees.md"
        ]
      },
      {
        title: "P2P Networking",
        area: "p2p",
        files: [
          "src/net_processing.cpp (message handlers: inv, getdata, headers sync)",
          "src/net.cpp (connection lifecycle, sockets)",
          "src/addrman.cpp (peer address management)",
          "src/banman.cpp (DoS bans)"
        ],
        flow: "Connections are accepted in net.cpp; messages are parsed and dispatched in net_processing.cpp. Headers-first sync drives block downloads; inv/getdata relay tx/blocks; addrman manages peers.",
        extras: [
          "doc/p2p.md",
          "doc/tor.md"
        ]
      },
      {
        title: "Wallet (optional)",
        area: "wallet",
        files: [
          "src/wallet/wallet.cpp (high-level wallet operations)",
          "src/wallet/spend.cpp (coin selection, fees)",
          "src/wallet/scriptpubkeyman.cpp (keys, descriptors, signing)",
          "src/wallet/db.cpp (Berkeley DB persistence)"
        ],
        flow: "Descriptor-based wallets track outputs, select coins for spends, build/sighash PSBTs, and persist metadata. RPCs require bitcoind started with a wallet or a loaded wallet file.",
        extras: [
          "doc/descriptors.md",
          "doc/psbt.md"
        ]
      },
      {
        title: "RPC Server",
        area: "rpc",
        files: [
          "src/rpc/server.cpp (registration, dispatch)",
          "src/rpc/blockchain.cpp (block/chain queries)",
          "src/rpc/rawtransaction.cpp (raw tx manipulation)",
          "src/rpc/wallet/ (wallet RPCs when enabled)"
        ],
        flow: "Handlers register with the RPC table, perform parameter validation, then call into node or wallet components. Transport is HTTP/JSON; access controlled by auth cookies or -rpcauth.",
        extras: [
          "doc/REST-interface.md",
          "doc/JSON-RPC-interface.md"
        ]
      },
      {
        title: "Testing",
        area: "test",
        files: [
          "test/functional/ (Python integration harness)",
          "src/test/ (C++ unit tests)",
          "src/bench/ (microbenchmarks)",
          "contrib/devtools/lint-all.sh (style and lint helper)"
        ],
        flow: "Functional tests spin up multiple regtest nodes and assert behavior across networking, mempool, wallet, and consensus. Unit tests cover serialization, script, and utility pieces.",
        extras: [
          "test/functional/README.md",
          "doc/bitcoin-qt.md"
        ]
      },
    ];

    const docs = [
      { label: "developer-notes", path: "doc/developer-notes.md" },
      { label: "validation", path: "doc/validation.md" },
      { label: "mempool + fees", path: "doc/mempool-and-fees.md" },
      { label: "p2p", path: "doc/p2p.md" },
      { label: "script", path: "doc/replace-by-fee.md" },
      { label: "wallet descriptors", path: "doc/descriptors.md" },
      { label: "psbt", path: "doc/psbt.md" },
    ];

    const cardsEl = document.getElementById("cards");
    const searchEl = document.getElementById("search");
    const filterEl = document.getElementById("filter");
    const docsEl = document.getElementById("docs");

    function renderCards() {
      const query = searchEl.value.toLowerCase();
      const area = filterEl.value;
      cardsEl.innerHTML = "";

      data
        .filter(item => (area === "all" || item.area === area))
        .filter(item =>
          !query ||
          item.title.toLowerCase().includes(query) ||
          item.files.some(f => f.toLowerCase().includes(query)) ||
          item.flow.toLowerCase().includes(query)
        )
        .forEach(item => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <div class="flex" style="justify-content: space-between;">
              <div class="pill">${item.area}</div>
            </div>
            <h3 style="margin:8px 0 6px;">${item.title}</h3>
            <p class="muted" style="margin:0 0 10px;">${item.flow}</p>
            <details>
              <summary>Files to open</summary>
              <ul class="list" style="margin-top:10px;">${item.files.map(f => `<li><span>${f}</span></li>`).join("")}</ul>
            </details>
            <details>
              <summary>Docs</summary>
              <ul class="list" style="margin-top:10px;">${item.extras.map(d => `<li><span>${d}</span></li>`).join("")}</ul>
            </details>
          `;
          cardsEl.appendChild(card);
        });
    }

    function renderDocs() {
      docsEl.innerHTML = docs.map(d => `
        <li>
          <span>${d.label}</span>
          <span class="tag">${d.path}</span>
        </li>
      `).join("");
    }

    searchEl.addEventListener("input", renderCards);
    filterEl.addEventListener("change", renderCards);

    renderCards();
    renderDocs();
  </script>
</body>
</html>
